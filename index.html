<!DOCTYPE html>
<html lang="en-us">

	<head>
		<style>
html {
	height: 100%;
}

		body {
			overflow: hidden;
			margin: 0;
			height: 100%;
			background: url(https://megamod-image.s3.amazonaws.com/bg.png);
			background-size: cover;
		}

		.shadow {
			/* box-shadow: 0 0 20px rgba(0, 0, 0, .2);
			border: 2px solid rgb(255, 255, 255);
			padding: 0px; */
		}

		canvas.dots {
			position: absolute;
			/* box-shadow: 0 0 20px rgba(0, 0, 0, .2);
			border: 2px solid rgb(255, 255, 255);
			padding: 0px; */
		}
		</style>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="og:image" content="https://d2c9flql2ljv41.cloudfront.net/images/og_image.jpg"/>
		<title>MegaMod</title>
		<link rel="shortcut icon" href="TemplateData/favicon.ico">
		<link rel="stylesheet" href="TemplateData/style.css">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&display=swap" rel="stylesheet">
		<script src="https://login-sdk.xsolla.com/latest/"></script>
		<script type="text/javascript" src ="js/libraries/unpkg.com_js-cookie@3.0.5_dist_js.cookie.min.js"></script>
  	<!-- <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script> -->
		<script type="text/javascript" src="js/cookies_manager.js"></script>
		<script type="text/javascript" src="js/unity.js"></script>
		<script type="text/javascript" src="js/helpers.js"></script>
		<script type="text/javascript" src="js/oauth_xsolla.js"></script>
		<script type="text/javascript" src="js/analytics_constants.js"></script>
		<script type="text/javascript" src="js/resizer.js"></script>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-SGFC31VKKL"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		  gtag('config', 'G-SGFC31VKKL');
		</script>
		<script>
			var options = {
				access_token: '',
				sandbox: false
			};

			var s = document.createElement('script');
			s.type = "text/javascript";
			s.async = true;
			s.src = "https://static.xsolla.com/embed/paystation/1.0.7/widget.min.js";
			s.addEventListener('load', function (e) {
				XPayStationWidget.init(options);

				XPayStationWidget.on('init', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_Init', 'Message');
				});

				XPayStationWidget.on('open', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_Opened', 'Message');
				});

				XPayStationWidget.on('load', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_Loaded', 'Message');
				});

				XPayStationWidget.on('close', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_Closed', 'Message');
				});

				XPayStationWidget.on('status', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_Status', 'Message');
				});

				XPayStationWidget.on('status-invoice', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_StatusInvoice', 'Message');
				});

				XPayStationWidget.on('status-delivering', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_StatusDelivering', 'Message');
				});

				XPayStationWidget.on('status-done', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_StatusDone', 'Message');
				});

				XPayStationWidget.on('status-troubled', function () {
					unityInstance.SendMessage('GameMenuUIMoreOrbsView', 'XPayStationWidget_StatusTroubled', 'Message');
				});

			}, false);
			var head = document.getElementsByTagName('head')[0];
			head.appendChild(s);

			function OpenXsollaPayStation(accessToken) {
				options.access_token = accessToken;
				XPayStationWidget.init(options);
				XPayStationWidget.open();
			}
		</script>

	</head>

	<body>
		<script src="js/ClientDataJS/ua-parser.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.js"></script>

		<div id="no-phone-container" style="width:100%; height:100%; display: none; justify-content: center;">
			<img src="https://megamod-image.s3.amazonaws.com/mobile_error.png" style="display: block; margin: auto;">
		</div>
		<div id="unity-container" class="unity-desktop">
			<div id="loader_canvas_div">
				<img class="shadow" id="SPLASH_SCREEN" src="https://megamod-image.s3.amazonaws.com/Game_loader_0011.jpg"
					   style="position: absolute;  top: 0; left: 0; width: 100%; height: 100%; object-fit: cover">
				<!-- old -->
				<!-- <img class="shadow" id="SPLASH_SCREEN" src="https://megamod-image.s3.amazonaws.com/Game_loader_0011.jpg"
					   style="position: absolute;"> -->
				<canvas class="dots" id="loader_canvas" width=1280 height=720 style="position: absolute;  top: 0; left: 0; width: 100%; height: 100%; object-fit: cover"></canvas>
			</div>
			<canvas class="shadow" id="unity-canvas" width=1280 height=720></canvas>
			<div id="unity-loading-bar">
				<div id="unity-progress-bar-empty">
					<div id="unity-progress-bar-full"></div>
				</div>
			</div>
			<div id="unity-warning"> </div>
		</div>
		<script type="text/javascript" src="js/app_version.js"></script>
		<script type="text/javascript" src="js/amplitude.js"></script>
		<script type="text/javascript" src="js/analytics.js"></script>
		<script type="text/javascript" src="js/redirects.js"></script>
		<script type="text/javascript" src="js/firebase.js"></script>
		<script type="text/javascript" src="js/discord.js"></script>
		<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
		<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
		<script>
			//#region Firebase
			firebaseInit();
			//#endregion Firebase
		</script>
		<script type="text/javascript" src="js/animated_loader.js"></script>
		<script>
			var num = Math.floor(Math.random() * 2); // 0...6
			//showLoader("https://megamod-image.s3.amazonaws.com/SPLASH_SCREEN_JPG" + (num + 1) + ".png");
			// showLoader("https://megamod-image.s3.amazonaws.com/SPLASH_SCREEN_JPG1_GAMES.png");
			showLoader("https://megamod-image.s3.amazonaws.com/Game_loader_0011.jpg");
		</script>
		<script>
			var container = document.querySelector("#unity-container");
			var mobile_error = document.querySelector("#no-phone-container");

			if (checkIfMobile()) {
				container.style.display = "none";
				mobile_error.style.display = "flex";
				sendEvent(HTML_No_Mobile_Version_Screen_Showed);
			}
			else {
				mobile_error.remove();
				var canvas = document.querySelector("#unity-canvas");
				var loader_canvas = document.querySelector("#loader_canvas");
				var SPLASH_SCREEN = document.querySelector("#SPLASH_SCREEN");
				var warningBanner = document.querySelector("#unity-warning");


				function unityShowBanner(msg, type) {
					function updateBannerVisibility() {
						warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
					}
					var div = document.createElement('div');
					div.innerHTML = msg;
					warningBanner.appendChild(div);
					if (type == 'error') div.style = 'background: red; padding: 10px;';
					else {
						if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
						setTimeout(function () {
							warningBanner.removeChild(div);
							updateBannerVisibility();
						}, 5000);
					}
					updateBannerVisibility();
				}

				var buildUrl = "Build";
				var loaderUrl = "LOADER_FILE_URL";
				var config = {
					dataUrl: "DATA_FILE_URL",
					frameworkUrl: "FRAMEWORK_FILE_URL",
					codeUrl: "WASM_FILE_URL",
					symbolsUrl: buildUrl + "/",
					streamingAssetsUrl: "FOLDER_NAME_STREAMING_ASSETS",
					companyName: "DefaultCompany",
					productName: "MegaMod",
					productVersion: "1.3.44",
					showBanner: unityShowBanner,
					cacheControl: function (url) {
						// Caching enabled for .data and .bundle files.
						// Revalidate if file is up to date before loading from cache
						//if (url.match(/\.data/) || url.match(/\.bundle/) || url.match(/\.wasm/)) {
						if (url.match(/\.bundle/)) {
							return "must-revalidate";
							//return "immutable";
						}

						// // Caching enabled for .mp4 and .custom files
						// // Load file from cache without revalidation.
						if (url.match(/\.data/) || url.match(/\.wasm/)) {
							return "immutable";
						}
						// // Caching enabled for .mp4 and .custom files
						// // Load file from cache without revalidation.
						// if (url.match(/\.mp4/) || url.match(/\.custom/)) {
						//     return "immutable";
						// }

						// Disable explicit caching for all other files.
						// Note: the default browser cache may cache them anyway.
						return "no-store";
					},
				};

				ResizerInit();

				var script = document.createElement("script");
				script.src = loaderUrl;
				var myGameInstance = null;
				script.onload = () => {
					sendEvent(Unity_WebGL_Hello_world);
					createUnityInstance(canvas, config, (progress) => {

					}).then((unityInstance) => {
						window.unityInstance = unityInstance;
						myGameInstance = unityInstance;

						setTimeout(function () {
							closeLoader();
							sendEvent(Splash_Screen_Loading_Finished);
						}, 2500);
					}).catch((message) => {
						alert(message);
					});

				};
				document.body.appendChild(script);
			}
		</script>
	</body>
</html>
